# 双向同步
双向同步是指在两个实例都有存量数据和写流量的情况下进行两实例同步，最终达到两实例数据动态一致的过程。
双向同步的难点是。由于redis本身没有实例id,在双向同步时形成数据回环。破环的主要方式是利用数据缓冲进行冲销

假设我们有两个redis实例redis1和redis2,再分别定义两个冲销池set1和set2。
1. 启动redis1->redis2的全量同步任务，
2. 启动redis1->redis2增量任务，增量任务先在set1做冲销(set1中存在的数据删除并丢弃同步)，未冲销数据同步到redis2
3. 启动redis2->redis1的全量任务,此全量同步数据一定会作为增量形成回环，所以要先写入set1再写入redis1,以便数据作为增量回环同步到redis2时利用set1冲销
4. 启动redis2->redis1增量任务，增量任务先在set2做冲销(set2中存在的数据删除并丢弃同步)，增量任务先写入set1在写入redis1避免循环复制
5. 改变redis1->redis2增量任务行为，增量任务先在set1做冲销(set1中存在的数据删除并丢弃同步)，未冲销数据先写入set2再同步到redis2

为什么增加第五步改变redis1->redis2增量任务行为呢？
因为在第四步完成时set2中并没有从redis1->redis2的增量数据，这会造成从redis1->redis2的增量数据会转换成redis2->redis1增量数据且在本地无法被冲销只有数据进入set1且被写入redis1后再次作为增量数据想redis2同步时才会被冲销，增加了网络开销同时redis1也增加了一次写入负载




# 过kafka双向同步